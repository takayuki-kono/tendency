# データ収集ドキュメント (Stage 1)

本ドキュメントでは、Web上からの画像収集および初期処理（顔検出・クロップ）について詳述します。

## 概要フロー
**スクリプト**: `download_and_filter_faces.py`
**役割**: キーワードに基づく画像の収集、顔検出、クロップ、保存。

---

## 処理詳細

### 1. メインスクリプト: `download_and_filter_faces.py`
ユーザーが定義した `KEYWORDS` リスト（人物名）に基づき、以下のコンポーネントを呼び出して収集パイプラインを実行します。

### 2. コンポーネント: `components/part1_setup.py`

#### A. 画像収集
現在は **Bing Image Search のみ** を使用して安定的な収集を行います。Google検索は廃止されました。

1.  **Bing Image Search**
    -   **ツール**: `icrawler.builtin.BingImageCrawler`
    -   **特徴**: メインの収集元。安定して大量の画像を収集可能。
    -   **設定**: `MAX_NUM` で基本枚数を制限。
    -   **検索ワード拡張**: 単一のキーワードだけでなく、以下のようなバリエーションで網羅的に収集します。
        -   `{キーワード} 正面`, `{キーワード} 顔`, `{キーワード} 笑顔`, `{キーワード} 横顔`
        -   `{キーワード} ドラマ`, `{キーワード} 映画`, `{キーワード} インタビュー`
        -   `{キーワード} 昔`, `{キーワード} 現在`
        -   英語表記: `{keyword} actress`, `{keyword} japanese` 等

#### B. 顔検出 & クロップ (InsightFace)
収集した生画像に対して、以下の処理を行います。

1.  **顔検出**: `insightface.app.FaceAnalysis` を使用し、画像内の顔をすべて検出。
2.  **回転補正 (Alignment)**:
    -   検出された `landmark_2d_106` を使用。
    -   顔の中心軸を計算し、画像の傾きを補正して正立（Rotation）させます。
3.  **領域クロップ**:
    -   眉の上から顎の下までを含む領域を切り出します。
    -   **画像サイズ**: `224x224` px にリサイズして保存。
    -   **保存先**: `master_data/{人物名}/rotated/`

#### C. パディングチェック
現在、パディング（黒帯）の比率によるフィルタリングは **無効化** されています（ユーザー要望により、多少の黒帯があっても保存します）。

---

## 変更履歴
- **2025-12-28 (2)**: パディング比率によるフィルタリング（5%以上でスキップ）を無効化。
- **2025-12-28**: Google画像検索（Selenium版）を廃止し、Bing検索のキーワード拡張による収集量確保へ方針変更。

## Author
Gemini