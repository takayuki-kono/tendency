# データ収集ドキュメント (Stage 1)

本ドキュメントでは、Web上からの画像収集および初期処理（顔検出・クロップ）について詳述します。

## 概要フロー
**スクリプト**: `download_and_filter_faces.py`
**役割**: 複数エンジンによる高画質画像の収集、顔検出、正立補正、224x224クロップ、および重複・別人の排除。

---

## 処理詳細 (Stage 1)

### 1. メインパイプライン: `download_and_filter_faces.py`
指定された人物名に基づき、以下の3ステップを自動実行します。

### ステップ 1: 画像収集と顔抽出 (`components/part1_setup.py`)
従来の icrawler に代わり、より高品質・大量収集が可能な **`pyimagedl`** 方式に完全移行しました。

-   **使用エンジン**: Yahoo, Bing, Baidu, Google
-   **収集戦略**: 
    -   キーワードを「女優 〇〇」に固定し、各エンジンの検索上位から純度の高い画像を収集。
    -   「Large Size」フィルタを適用し、高解像度の元画像のみをダウンロード。
-   **顔加工 (InsightFace)**:
    -   ダウンロード直後に顔を検出し、**正立補正 (Rotation Alignment)** を実施。
    -   眉の上から顎の下までを切り出し、`224x224` px にリサイズ。
    -   パディング（黒帯）制限は無効化されており、多少の余白があっても保存されます。
-   **保存先**: `master_data/{人物名}/rotated/` (中間ディレクトリ)

### ステップ 2: 重複排除 (`components/part2a_similarity.py`)
収集した顔画像の中から、同一画像や極めて似ている画像を削除します。
-   **保存先**: `deleted_duplicates/` (論理削除の場合)

### ステップ 3: 人物選別 (`components/part2b_filter.py`)
クラスタリングにより、対象人物以外の顔（共演者や誤検出など）を自動排除します。
-   **保存先**: `deleted_outliers/` (論理削除の場合)

---

## 変更履歴
- **2025-12-28 (4)**: `download_and_filter_faces.py` の内部エンジンを全面的に `imagedl` ベースに移行。Yahoo, Baiduを含むマルチエンジン体制へ。
- **2025-12-28 (2)**: パディング比率によるフィルタリングを無効化。
- **2025-12-28**: Google画像検索（Selenium版）を廃止。

## Author
Gemini